{% extends 'admin_sistema/base.html' %}

{% load static %}

{% block head %}    
    <!-- Bootstrap -->
    <link href="{% static 'vendors/bootstrap/dist/css/bootstrap-slider.min.css' %}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">

    <!-- INTROJS -->
    <link href="{% static 'vendors/introjs/css/introjs.min.css' %}" rel="stylesheet"/>
  <!-- switch personalizado -->
    <!-- <link rel="stylesheet" href="../vendors/pangeos/build/css/switch.css" type="text/css"> -->

    <link href="{% static 'vendors/sweetalert/dist/sweetalert2.min.css' %}" rel="stylesheet"/>

    <!--MAPS  -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <link href="{% static 'vendors/pangeos/css/pangeos.css' %}" rel="stylesheet">
    <link href="{% static 'vendors/pangeos/css/pangeos-mapas.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}
        <div class="col-12 col-sm-12 col-md-12 col-xl-12 col-lg-12" role="main">
          <div class="row">
              <div class="col-12 col-sm-12 col-md-12 col-xl-12 col-lg-12">
                  <div id="dataWrapper">
                      <div id="mainInfo">
                          <div class="row">
                              <div class="col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                  <section class="consultarSection" id="prop2">
                                        <div class="x_panel" id="info_indicador">
                                                  <div class="lnk-ayuda2Wrapper">
                                                    <div class="grey_link grey_link_right lnk-ayuda2" id="btn-guiaDescription">
                                                        [?] Ayuda
                                                        <svg viewBox="0 0 70 36">
                                                            <path d="M 6.9739 30.8153 H 63.0244 C 65.5269 30.8152 75.5358 -3.68471 35.4998 2.81531 C -16.1598 11.2025 0.894099 33.9766 26.9922 34.3153 C 104.062 35.3153 54.5169 -6.68469 23.489 9.31527" />
                                                        </svg>
                                                    </div>
                                                  </div>
                                            <div class="x_content">
                                                  <div id="titleWrapper" class="titleSection">
                                                      <h5 id="indicadorTitle">Tasa de egresos por lesiones autoinfligidas</h5>
                                                  </div>
                                                  <hr/>
                                                  <div id="importanceWrapper" class="description-step1">
                                                      <h6 class="titleSection"><strong>Importancia: </strong><span id="importanceTxt" class="txtDescripcion">
El suicidio es un problema emergente de salud pública. Según la OMS (2021), en el mundo, cerca de un millón de personas se quita la vida cada año; y, por cada una suicidio consumado, muchas personas más lo intentan. <br/>
Existe evidencia para pensar que en pleno siglo XXI persiste un subregistro en las muertes por suicidio y el comportamiento suicida debido al impacto y estigma al rededor de este comportamiento.  Por consiguiente, analizar los registros hospitalarios relacionados con autolesiones permite tener un panorama más cercano a la estimación sobre el comportamiento suicida.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="descriptionWrapper" class="description-step2" >
                                                      <h6 class="titleSection"><strong>Descripción: </strong> <span id="descriptionTxt" class="txtDescripcion">
Expresa la relación entre el número de personas que se hospitalizaron y presentaron una lesión autoinfligida intencionalmente y el total de la población. <br/>
Se consideran los egresos con los códigos X60-X84, Y87.0, de acuerdo con la Clasificación Estadística Internacional de Enfermedades y Problemas Relacionados con la Salud (CIE-10).
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="disintegrationWrapper" class="description-step3">
                                                      <h6 class="titleSection"><strong>Desagregación: </strong> <span id="desagregationTxt" class="txtDescripcion">
Geográfica: municipal, entidad y nacional. De los sujetos: sexo, edad y grupo de edad quinquenal
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="calcmethodWrapper" class="description-step4">
                                                        <h6 class="titleSection"><strong>Método de cálculo: </strong> <span id="descriptionTxt" class="txtDescripcion">
                                                          <p>
                                                              <img src="{% static 'images/ecuaciones/egresos-trastornos-formula.png' %}" width="35%">
                                                          </p>
                                                          <div id="calcmethodDescWrapper">
Donde:<br/>
<i>TegSUIC<sup>t</sup></i> = Tasa de egresos hospitalarios por suicidio<br/>
<i>EgreSUIC<sup>t</sup></i> = Egresos hospitalarios por suicidio<br/>
<i>p<sup>t</sup></i> = Población a mitad del año <br/>
<i>t</i> = Año de referencia<br/>
                                                          </div>
                                                          <!-- <p>Unidad de medida: <span id="metodocalculounidaddemedida">Egresos por 100 000 habitantes</span></p> -->
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="unitWrapper" style="display: none;" class="description-step5.1">
                                                      <h6 class="titleSection"><strong>Unidad de Medida: </strong> <span id="unitTxt" class="txtDescripcion">
Egresos por 100 000 habitantes
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="sourceWrapper" class="description-step5">
                                                      <h6 class="titleSection"><strong>Fuentes de la información estadística: </strong> <span id="descriptionTxt" class="txtDescripcion">
1) Instituto Nacional de Estadística y Geografía y Secretaría de Salud: Estadísticas de Mortalidad. 
2) Consejo Nacional de Población: Proyecciones de la población de México, vigentes.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="diffusionfrequencyWrapper" class="description-step6">
                                                      <h6 class="titleSection"><strong>Frecuencia prevista de difusión de datos: </strong> <span id="difFrequencyTxt" class="txtDescripcion">
Anual con 6 meses de retraso.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="compilationfrequencyWrapper" class="description-step7">
                                                      <h6 class="titleSection"><strong>Frecuencia prevista de recopilación de datos: </strong> <span id="recFrequencyTxt" class="txtDescripcion">
Anual.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="updateDateWrapper" style="display: none;" class="description-step7.1">
                                                      <h6 class="titleSection"><strong>Fecha de actualización: </strong> <span id="updateDateTxt" class="txtDescripcion">
Julio de 2022
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="limitationsWrapper" class="description-step8">
                                                      <h6 class="titleSection"><strong>Limitaciones: </strong><span id="limitationsTxt" class="txtDescripcion">
Falta de precisión en los diagnósticos que detonan la hospitalización y en las afecciones asociadas debido a la expertis para el manejo de los diagnósticos y códigos de clasificación empleados por personal médico y administrativo.<br/>
Falta de uniformidad en el registro de la información.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div id="referencesWrapper" style="display: none;" class="description-step8.1">
                                                      <h6 class="titleSection"><strong>Referencias: </strong> <span id="referencesTxt" class="txtDescripcion">
Organización Mundial de la Salud. http://www.who.int/mental_health/suicide-prevention/es/<br/>
http://www.who.int/research/es/<br/>
Organización Panamericana de la Salud. http://new.paho.org/hq/index.php?option=com_content&task=view&id=2470&Itemid=2003<br/>
Organización de Cooperación y Desarrollo Económicos. http://www.oecd-ilibrary.org/social-issues-migration-health/health-at-a-glance-2013_health_glance-2013-en<br/>
Population Reference Bureau. http://www.prb.org/Reports/2011/prb-population-handbook-2011.aspx<br/>
Dávila Cervantes, Claudio Alberto, María del Pilar Ochoa Torres, and Irene Casique Rodríguez. 2015. “Análisis Del Impacto de La Mortalidad Por Suicidios En México, 2000-2012.” Salud Colectiva 11(4): 471–84.<br/>
OMS (2021) Suicidio https://www.who.int/es/news-room/fact-sheets/detail/suicide
                                                      </span></h6>
                                                  </div>
                                                  <div id="infoFontsWrapper" style="display: none;" class="description-step8.1">
                                                      <h6 class="titleSection"><strong>Fuentes de información: </strong> <span id="infoFontsTxt" class="txtDescripcion">
Numerador: Egresos<br/>
Secretaría de Salud. (2022). Base de datos del Subsistema automatizado de egresos hospitalarios 2000 a 2020. Disponible en: http://www.dgis.salud.gob.mx/contenidos/basesdedatos/da_egresoshosp_gobmx.html<br/>

Denominador: Proyecciones Municipales 2000 -2015<br/>
Secretaría General del Consejo Nacional de Población. Estimación de la población de los municipios del país, 2000-2015, con base en INEGI, XII Censo General de Población y Vivienda 2000, II Conteo de Población y Vivienda 2005, Censo de Población y Vivienda 2010, la Encuesta Intercensal 2015 y en CONAPO, Conciliación demográfica de México, 1950-2015.<br/>
Proyecciones Municipales 2015-2021<br/>
-Secretaría General del Consejo Nacional de Población. (2019). Proyecciones de la Población de los Municipios de México y de las Entidades Federativas, 2016-2050.
                                                      </span></h6>
                                                  </div>
                                                  <hr/>
                                                  <div class="d-flex justify-content-end">
                                                      <button id="ficha_indicador" style="border: 0px;">Descargar Ficha</button>
                                                  </div>
                                            </div>
                                        </div>
                                  </section>
                              </div>
                              <div class="col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                  <section class="consultarSection">
                                      <div class="x_panel">
                                                  <div class="lnk-ayuda2Wrapper">
                                                    <div class="grey_link grey_link_right lnk-ayuda2" id="btn-guiaMapa">
                                                        [?] Ayuda
                                                        <svg viewBox="0 0 70 36">
                                                            <path d="M 6.9739 30.8153 H 63.0244 C 65.5269 30.8152 75.5358 -3.68471 35.4998 2.81531 C -16.1598 11.2025 0.894099 33.9766 26.9922 34.3153 C 104.062 35.3153 54.5169 -6.68469 23.489 9.31527" />
                                                        </svg>
                                                    </div>
                                                  </div>
                                          <div class="x_title">
                                                <h5 id="graph1Title">Registros de egresos por lesiones en México</h5>&nbsp;
                                                <div class="row">
                                                    <div class="col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 guiamapa-step1">
                                                          <label>Año de registro*</label>
                                                            <select class="form-control" id="anoregistroselector" >
                                                                <option value="0" selected>Todos los años de registro</option>
                                                                {% for an in anio_cubo_nac %} 
                                                                <option value="{{an.anio}}">{{an.anio}}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <div class="clearfix"></div>
                                                    </div>
                                                    <div class="col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 guiamapa-step2">
                                                        <label>Sexo</label>
                                                        <select class="form-control" id="sexoregistroselector" >
                                                            {% for s in sexo %} 
                                                            <option value="{{s.idcatsexo}}" {% if forloop.first %}selected{% endif %}>{{s.descripcion}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 guiamapa-step3">
                                                      <!-- <span id="ctrl_edad-label-2">Edad</span> -->
                                                      <p style="padding: 25px 0px 10px 0px;">
                                                          <input id="ctrl_edad2" type="text" class="span2" value="" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="[0,109]" data-slider-labelledby='ctrl_edad-label-2'/>
                                                          <span id="ex6CurrentSliderValLabel2">Edad entre los : <span id="ctrl_edad_I2">0</span> y los <span id="ctrl_edad_F2">109</span> años</span>
                                                    </div>
                                                </div>
                                          </div>
                                          <div class="x_content">
                                                <div id="geochart-colors" style="width: 100%; height: 100%;" class="guiamapa-step4"></div>
                                                <div id="googleMaps"><div class="closeMap"></div></div>
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                        <a href="#" id="btnMostrarImagen" role="link" class="btn btn-primary">Descargar como Imagen</a>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                        <a href="#" id="btnMostrarMapa" role="link" class="btn btn-primary">Ampliar a pantalla completa</a>
                                                    </div>
                                                </div>
                                          </div>
                                          <div id="sourceData"><span class="sources">Fuente(s): </span> <span id="">Instituto Nacional de Psiquiatría. Universidad Nacional Autónoma de México</span></div>
                                          <div id="updatedData"><span class="sources">Datos actualizados al:</span> <span id="updatedDataDate">31/12/2018</span></div>
                                      </div>
                                  </section>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-12 col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" id="content_distribucion">
                                  <section class="consultarSection" style="flex-direction: column;">
                                      <div class="x_panel">
                                                  <div class="lnk-ayuda2Wrapper">
                                                    <div class="grey_link grey_link_right lnk-ayuda2" id="btn-guiaMapaGrafica">
                                                        [?] Ayuda
                                                        <svg viewBox="0 0 70 36">
                                                            <path d="M 6.9739 30.8153 H 63.0244 C 65.5269 30.8152 75.5358 -3.68471 35.4998 2.81531 C -16.1598 11.2025 0.894099 33.9766 26.9922 34.3153 C 104.062 35.3153 54.5169 -6.68469 23.489 9.31527" />
                                                        </svg>
                                                    </div>
                                                  </div>
                                        <div class="x_title">
                                            <h5 id="mainGraphData">Tasa de egresos por lesiones, por entidad federativa y sexo México, 2000 a 2018</h5>
                      <div class="custom-control custom-switch guiamapagrafica-step1">
                                  <div class="form-check form-switch">
                                        <input type="checkbox" data-toggle="toggle" data-size="sm" data-width="125" data-onstyle="success" data-on="Tasa" data-off="Registros"  data-offstyle="warning"  data-style="ios">
                                  </div>
                                            <div class="clearfix"></div>
                                        </div>
                                        <div class="x_content">
                                          <div>
                                              <div id="mainGrpah" style="width: 100%;height:500px;" class="guiamapagrafica-step2"></div>
                                          </div>
                                        </div>
                                      </div>
                                      </div> <!-- add -->
                                      <div class="d-flex justify-content-end">
                                          <button id="crearimagen_distribucion" style="border: 0px;">Descargar</button>
                                      </div>
                                  </section>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-12 col-xm-12 col-sm-12 col-md-6 col-lg-6 col-xl-6" id="content_gb">
                                  <section class="consultarSection">
                                      <div class="x_panel">
                                          <div class="x_title">
                                              <h5 id="secondGraphtitle">Egresos por lesiones por edades</h5>
                                          </div>
                                          <div class="x_content">
                                              <div class="row">
                                                  <div class="col-12 col-xm-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                      <select class="form-control entidadselect">
                                                          <option value="0">Entidad</option>
                                                      </select>
                                                  </div>
                                                  <div class="col-12 col-xm-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                      <select class="form-control anyoselect">
                                                          <option value="0">Año de registro</option>
                                                      </select>
                                                  </div>
                                              </div>
                                              <div id="echart_line" style="height:350px;"></div>
                                          </div>
                                          <div id="sourceData"><span class="sources">Fuente(s):</span> <span id="">Instituto Nacional de Psiquiatría. Universidad Nacional Autónoma de México</span></div>
                                          <div id="updatedData"><span class="sources">Datos actualizados al:</span> <span class="updatedDataDate">Febrero 2022</span></div>
                                            <div class="d-flex justify-content-end">
                                                <button id="crearimagen" style="border: 0px;">Descargar</button>
                                            </div>
                                      </div>
                                  </section>
                              </div>
                              <div class="col-12 col-xm-12 col-sm-12 col-md-6 col-lg-6 col-xl-6" id="content_gp">
                                  <section class="consultarSection">
                                      <div class="x_panel">
                                          <div class="x_title">
                                              <h5 id="secondGraphtitle">Tasa de mortalidad por tipo de suicido</h5>
                                          </div>
                                          <div class="x_content">
                                              <div class="row">
                                                  <div class="col-12 col-xm-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
                                                      <select class="form-control entidadselect">
                                                          <option value="0">Entidad</option>
                                                      </select>
                                                  </div>
                                                  <div class="col-12 col-xm-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
                                                      <select class="form-control">
                                                          <option value="0">Sexo</option>
                                                          <option value="m">Masculino</option>
                                                          <option value="f">Femenino</option>
                                                      </select>
                                                  </div>
                                                  <div class="col-12 col-xm-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
                                                      <select class="form-control anyoselect">
                                                          <option value="0">Año de registro</option>
                                                      </select>
                                                  </div>
                                              </div>
                                              <div id="echart_pie" style="height:350px;"></div>
                                          </div>
                                          <div id="sourceData"><span class="sources">Fuente(s):</span> <span id="">Instituto Nacional de Psiquiatría. Universidad Nacional Autónoma de México</span></div>
                                          <div id="updatedData"><span class="sources">Datos actualizados al:</span> <span class="updatedDataDate">Febrero 2022</span></div>
                                            <div class="d-flex justify-content-end">
                                                <button id="crearimagen_pastel" style="border: 0px;">Descargar</button>
                                            </div>
                                      </div>
                                  </section>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-12 col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                              <div id="table-wrapper">
                          <div id="tablecontrols" class="col-12">
                              <div class="lnk-ayuda2Wrapper">
                                <div class="grey_link grey_link_right lnk-ayuda2" id="btn-guiaTabla">
                                    [?] Ayuda
                                    <svg viewBox="0 0 70 36">
                                        <path d="M 6.9739 30.8153 H 63.0244 C 65.5269 30.8152 75.5358 -3.68471 35.4998 2.81531 C -16.1598 11.2025 0.894099 33.9766 26.9922 34.3153 C 104.062 35.3153 54.5169 -6.68469 23.489 9.31527" />
                                    </svg>
                                </div>
                              </div>
                          </div>
                          <span id="btn-showtable" class="guiatabla-step1">Mostrar detalle de Datos</span>
                                  <div id="table-viewport">
                                      <div class="card-box table-responsive">
                                          <p class="text-muted font-13 m-b-30">
                                              Distribución geográfica de datos
                                          </p>
                                          <div id="datatable_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap no-footer">
                                            <div class="row">
                                                <div class="col-12 col-xs-12 col-sm-12 col-md-3 col-lg-3 col-xl-3">
                                                    <label>Sexo</label>
                                                        <select class="form-control" id="sexoTabla"  style="font-size: 0.9em;">
                                                          <option value="t">Todos (total agrupado)</option>
                                                          <option value="t">Todos (total desagregado por sexo)</option>
                                                          <option value="f">Femenino</option>
                                                          <option value="m">Masculino</option>
                                                          <option value="x">No indentificado</option>
                                                        </select>
                                                </div>
                                                <div class="col-12 col-xs-12 col-sm-12 col-md-3 col-lg-3 col-xl-3">
                                                  <!-- <span id="ctrl_edad-label-2">Edad</span> -->
                                                  <p style="padding: 25px 20px 10px 20px;">
                                                      <input id="ctrl_edad3" type="text" class="span3" value="" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="[0,109]" data-slider-labelledby='ctrl_edad-label-3'/>
                                                      <span id="ex6CurrentSliderValLabel3">Edad entre los : <span id="ctrl_edad_I3">0</span> y los <span id="ctrl_edad_F3">109</span> años</span>
                                                </div>
                                                <div class="col-12 col-xs-12 col-sm-12 col-md-3 col-lg-3 col-xl-3">
                                                    <label>Medios</label>
                                                        <select class="form-control" id="medioTabla"  style="font-size: 0.9em;">
                                                          <option value="t">Todos (total agrupado)</option>
                                                          <option value="t">Todos (total desagregado por medio de suicidio)</option>
                                                          <option value="e">Envenenamiento</option>
                                                          <option value="a">Ahorcamiento</option>
                                                          <option value="h">Ahogamiento</option>
                                                          <option value="r">Arma de fuego</option>
                                                          <option value="o">Otros medios</option>
                                                        </select>
                                                </div>
                                                <div class="col-12 col-xs-12 col-sm-12 col-md-3 col-lg-3 col-xl-3">
                                                    <label>&nbsp</label>
                                                    <button class="btn btn-primary btn-block">Filtrar</button>
                                                </div>
                                            </div>
                                            <div class="row">
                                              <div class="col-sm-12">
                                                <table id="datatable" class="table table-striped table-bordered dataTable no-footer" style="width:100%" role="grid" aria-describedby="datatable_info">
                                                  <thead>
                                                    <tr role="row">
                                                        <th class="sorting_asc" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 252px;">Nacional</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2000: activate to sort column ascending" style="width: 398px;">2000</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2001: activate to sort column ascending" style="width: 195px;">2001</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2002: activate to sort column ascending" style="width: 105px;">2002</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2003: activate to sort column ascending" style="width: 184px;">2003</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2004: activate to sort column ascending" style="width: 154px;">2004</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2005: activate to sort column ascending" style="width: 154px;">2005</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2006: activate to sort column ascending" style="width: 154px;">2006</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2007: activate to sort column ascending" style="width: 154px;">2007</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2008: activate to sort column ascending" style="width: 154px;">2008</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2009: activate to sort column ascending" style="width: 154px;">2009</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2010: activate to sort column ascending" style="width: 154px;">2010</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2011: activate to sort column ascending" style="width: 154px;">2011</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2012: activate to sort column ascending" style="width: 154px;">2012</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2013: activate to sort column ascending" style="width: 154px;">2013</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2014: activate to sort column ascending" style="width: 154px;">2014</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2015: activate to sort column ascending" style="width: 154px;">2015</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2016: activate to sort column ascending" style="width: 154px;">2016</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2017: activate to sort column ascending" style="width: 154px;">2017</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2018: activate to sort column ascending" style="width: 154px;">2018</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="2019: activate to sort column ascending" style="width: 154px;">2019</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                        <tr role="row" class="odd">
                                                          <td class="sorting_1">Aguascalientes</td>
                                                          <td>964010</td>
                                                          <td>987520</td>
                                                          <td>1011950</td>
                                                          <td>1036717</td>
                                                          <td>1061561</td>
                                                          <td>1086798</td>
                                                          <td>1110011</td>
                                                          <td>1131266</td>
                                                          <td>1153468</td>
                                                          <td>1176168</td>
                                                          <td>1198510</td>
                                                          <td>1223425</td>
                                                          <td>1250962</td>
                                                          <td>1278202</td>
                                                          <td>1305273</td>
                                                          <td>1331825</td>
                                                          <td>1355321</td>
                                                          <td>1375782</td>
                                                          <td>1395794</td>
                                                          <td>1415421</td>
                                                        </tr>
                                                        <tr role="row" class="even">
                                                          <td class="sorting_1">Baja California</td>
                                                          <td>2493675</td>
                                                          <td>2565903</td>
                                                          <td>2640732</td>
                                                          <td>2716612</td>
                                                          <td>2792913</td>
                                                          <td>2870428</td>
                                                          <td>2939646</td>
                                                          <td>3000933</td>
                                                          <td>3064928</td>
                                                          <td>3130426</td>
                                                          <td>3183653</td>
                                                          <td>3222606</td>
                                                          <td>3258386</td>
                                                          <td>3292766</td>
                                                          <td>3326218</td>
                                                          <td>3357794</td>
                                                          <td>3403335</td>
                                                          <td>3462872</td>
                                                          <td>3521242</td>
                                                          <td>3578561</td>
                                                        </tr>
                                                        <tr role="row" class="odd">
                                                          <td class="sorting_1">Baja California Sur</td>
                                                          <td>434318</td>
                                                          <td>450092</td>
                                                          <td>466394</td>
                                                          <td>482984</td>
                                                          <td>499719</td>
                                                          <td>516740</td>
                                                          <td>537801</td>
                                                          <td>563113</td>
                                                          <td>589287</td>
                                                          <td>616122</td>
                                                          <td>636185</td>
                                                          <td>651419</td>
                                                          <td>668635</td>
                                                          <td>685784</td>
                                                          <td>702923</td>
                                                          <td>719846</td>
                                                          <td>736995</td>
                                                          <td>754270</td>
                                                          <td>771294</td>
                                                          <td>788119</td>
                                                        </tr>
                                                        <tr role="row" class="even">
                                                          <td class="sorting_1">Campeche</td>
                                                          <td>704360</td>
                                                          <td>717580</td>
                                                          <td>731445</td>
                                                          <td>745529</td>
                                                          <td>759630</td>
                                                          <td>773981</td>
                                                          <td>786594</td>
                                                          <td>797547</td>
                                                          <td>809041</td>
                                                          <td>820800</td>
                                                          <td>833942</td>
                                                          <td>849941</td>
                                                          <td>867064</td>
                                                          <td>883911</td>
                                                          <td>900589</td>
                                                          <td>916832</td>
                                                          <td>933436</td>
                                                          <td>950458</td>
                                                          <td>967319</td>
                                                          <td>984046</td>
                                                        </tr>
                                                        <tr role="row" class="odd">
                                                          <td class="sorting_1">Coahuila</td>
                                                          <td>3978878</td>
                                                          <td>4056667</td>
                                                          <td>4137733</td>
                                                          <td>4219579</td>
                                                          <td>4301148</td>
                                                          <td>4383744</td>
                                                          <td>4472341</td>
                                                          <td>4567654</td>
                                                          <td>4666821</td>
                                                          <td>4768075</td>
                                                          <td>4857906</td>
                                                          <td>4944937</td>
                                                          <td>5038786</td>
                                                          <td>5130494</td>
                                                          <td>5220622</td>
                                                          <td>5307819</td>
                                                          <td>5393944</td>
                                                          <td>5479352</td>
                                                          <td>5563869</td>
                                                          <td>5647532</td>
                                                        </tr>
                                                        <tr role="row" class="even">
                                                          <td class="sorting_1">Colima</td>
                                                          <td>3078281</td>
                                                          <td>3122063</td>
                                                          <td>3167874</td>
                                                          <td>3213827</td>
                                                          <td>3259221</td>
                                                          <td>3304999</td>
                                                          <td>3341601</td>
                                                          <td>3369106</td>
                                                          <td>3397985</td>
                                                          <td>3426919</td>
                                                          <td>3461882</td>
                                                          <td>3499552</td>
                                                          <td>3531604</td>
                                                          <td>3561704</td>
                                                          <td>3590344</td>
                                                          <td>3616481</td>
                                                          <td>3649416</td>
                                                          <td>3689398</td>
                                                          <td>3727984</td>
                                                          <td>3765325</td>
                                                        </tr>
                                                        <tr role="row" class="odd">
                                                          <td class="sorting_1">Chiapas</td>
                                                          <td>8640993</td>
                                                          <td>8694150</td>
                                                          <td>8751549</td>
                                                          <td>8807884</td>
                                                          <td>8861590</td>
                                                          <td>8915004</td>
                                                          <td>8941792</td>
                                                          <td>8941750</td>
                                                          <td>8942665</td>
                                                          <td>8941128</td>
                                                          <td>8981871</td>
                                                          <td>9034475</td>
                                                          <td>9049100</td>
                                                          <td>9057829</td>
                                                          <td>9062022</td>
                                                          <td>9058734</td>
                                                          <td>9053990</td>
                                                          <td>9049086</td>
                                                          <td>9041395</td>
                                                          <td>9031213</td>
                                                        </tr>
                                                        <tr role="row" class="even">
                                                          <td class="sorting_1">Chihuahua</td>
                                                          <td>2334987</td>
                                                          <td>2377883</td>
                                                          <td>2422563</td>
                                                          <td>2467594</td>
                                                          <td>2512460</td>
                                                          <td>2557832</td>
                                                          <td>2602657</td>
                                                          <td>2647284</td>
                                                          <td>2693767</td>
                                                          <td>2741112</td>
                                                          <td>2786124</td>
                                                          <td>2830310</td>
                                                          <td>2874749</td>
                                                          <td>2917922</td>
                                                          <td>2960145</td>
                                                          <td>3000556</td>
                                                          <td>3043062</td>
                                                          <td>3087852</td>
                                                          <td>3132017</td>
                                                          <td>3175643</td>
                                                        </tr>
                                                        <tr role="row" class="odd">
                                                          <td class="sorting_1">Ciudad de México</td>
                                                          <td>544180</td>
                                                          <td>551107</td>
                                                          <td>558424</td>
                                                          <td>565772</td>
                                                          <td>573033</td>
                                                          <td>580362</td>
                                                          <td>591856</td>
                                                          <td>607687</td>
                                                          <td>624105</td>
                                                          <td>640893</td>
                                                          <td>655211</td>
                                                          <td>668122</td>
                                                          <td>681887</td>
                                                          <td>695408</td>
                                                          <td>708738</td>
                                                          <td>721696</td>
                                                          <td>734663</td>
                                                          <td>747603</td>
                                                          <td>760333</td>
                                                          <td>772842</td>
                                                        </tr>
                                                        <tr role="row" class="even">
                                                          <td class="sorting_1">Durango</td>
                                                          <td>1470425</td>
                                                          <td>1486134</td>
                                                          <td>1502756</td>
                                                          <td>1519368</td>
                                                          <td>1535647</td>
                                                          <td>1552034</td>
                                                          <td>1570259</td>
                                                          <td>1590553</td>
                                                          <td>1611815</td>
                                                          <td>1633391</td>
                                                          <td>1656602</td>
                                                          <td>1682438</td>
                                                          <td>1708439</td>
                                                          <td>1733606</td>
                                                          <td>1758160</td>
                                                          <td>1781575</td>
                                                          <td>1801963</td>
                                                          <td>1819494</td>
                                                          <td>1836460</td>
                                                          <td>1852952</td>
                                                        </tr>
                                                  </tbody>
                                               </table>
                                            </div>
                                          </div>
                                          <div class="row">
                                            <div class="col-sm-5">
                                                <div class="dataTables_info" id="datatable_info" role="status" aria-live="polite">Mostrando 1 al 10 de 57 registros</div>
                                            </div>
                                            <div class="col-sm-7">
                                                <div class="dataTables_paginate paging_simple_numbers" id="datatable_paginate">
                                                    <ul class="pagination">
                                                      <li class="paginate_button previous disabled" id="datatable_previous">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="0" tabindex="0">Anterior</a>
                                                      </li>
                                                      <li class="paginate_button active">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="1" tabindex="0">1</a>
                                                      </li>
                                                      <li class="paginate_button ">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="2" tabindex="0">2</a>
                                                      </li>
                                                      <li class="paginate_button ">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="3" tabindex="0">3</a>
                                                      </li>
                                                      <li class="paginate_button ">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="4" tabindex="0">4</a>
                                                      </li>
                                                      <li class="paginate_button ">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="5" tabindex="0">5</a>
                                                      </li>
                                                      <li class="paginate_button ">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="6" tabindex="0">6</a>
                                                      </li>
                                                      <li class="paginate_button next" id="datatable_next">
                                                          <a href="#" aria-controls="datatable" data-dt-idx="7" tabindex="0">Siguiente</a>
                                                      </li>
                                                    </ul>
                                                  </div>
                                                </div>
                                            </div>
                                          </div>
                                          <div id="sourceData"><span class="sources">Fuente(s):</span> <span id="">Instituto Nacional de Psiquiatría. Universidad Nacional Autónoma de México</span></div>
                                          <div id="updatedData"><span class="sources">Datos actualizados al:</span> <span id="updatedDataDate">31/12/2018</span></div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
            <div id="controles">
              <div id="wrapper_controles">
                  <div id="handler">Mostrar menú</div>
                        <div class="" id="menufilterswrapper">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                              <div class="row">
                                  <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                      <div class="grey_link grey_link_left lnk-ayuda2" id="btn-guia">[?] Ayuda</div>
                                      <div class="grey_link grey_link_right" id="btn-closePanel">[X] Cerrar</div>
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step1" style="margin-bottom:10px">
                                                <select class="form-control" id="regionselector" style="font-size: 0.9em;">
                                                    <option value="0">-- Seleccionar región</option>
                                                    <option value="1">Norcentral</option>
                                                    <option value="2">Noroccidental</option>
                                                    <option value="3">Nororiental</option>
                                                    <option value="4">Occidental</option>
                                                    <option value="5">Centro</option>
                                                    <option value="6">Centro Sur</option>
                                                    <option value="7">Sur</option>
                                                </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step2">
                                                <select class="form-control h-25 mb-3" id="estadosselector" style="font-size: 0.9em;">
                                                    <option value="0">-- Seleccionar estado</option>
                                                </select>
                                            <div id="edoscontainer" class="edosinput panel-step3">
                                                <div id="edosviewport">
                                                  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                     <div class="row">
                                          <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step4">
                                              <label class="control-label col-md-3 col-sm-3 ">Municipios</label>
                                          </div>
                                          <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                              <select id="dropmunicipios" class="form-control h-25" multiple="multiple" style="display: none;">

                                              </select>
                                          </div>
                                          <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                              <div id="mupioscontainer" class="mupiosinput">
                                                  <div id="mupiosviewport">
                                                    
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="row">
                                          <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step5">
                                              <p>
                                                <label for="sexoselector">Sexo</label>
                                                <select class="form-control h-25" id="sexoselector"  style="font-size: 0.9em;">
                                                    <option value="0" selected="selected">Todos</option>                                                
                                                    <option value="m">Masculino</option>                                                
                                                    <option value="f">Femenino</option>                                                
                                                </select>
                                              </p>
                                          </div>
                                      </div>
                                      <div class="row">
                                          <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step6">
                                            <span id="ctrl_edad-label-1">Grupo de edad</span>
                                            <p style="padding: 5px 20px;">
                                                <input id="ctrl_edad" type="text" class="span2" value="" data-slider-min="0" data-slider-max="70" data-slider-step="5" data-slider-value="[0,70]" data-slider-labelledby='ctrl_edad-label-1' data-slider-tooltip="hide"/>
                                                <span id="ex6CurrentSliderValLabel">Edad entre los : <span id="ctrl_edad_I">0</span> y los <span id="ctrl_edad_F">>65</span> años</span>
                                            </p>
                                          </div>
                                      </div>
                                      <div class="row">
                                          <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 panel-step7">
                                              <p>
                                                <label>Año de registro</label>
                                                <select class="form-control" id="anoregistroselector" >
                                                    <option value="0" selected>Todos los años de registro</option>
                                                    {% for an in anio_cubo_nac %} 
                                                    <option value="{{an.anio}}">{{an.anio}}</option>
                                                    {% endfor %}
                                                </select>
                                              </p>
                                          </div>
                                      </div>
                                      <div class="row">
                                          <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-xl-12 col-lg-12">
                                            <button type="button" class="btn btn-success btn-block" id="filtroBuscar">Buscar</button>
                                          </div>
                                          <div class="col-12 col-xm-12 col-sm-12 col-md-12 col-xl-12 col-lg-12">
                                            <button type="button" class="btn-filtros btn btn-warning btn-block" id="filtroLimpiar">Limpiar</button>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                        </div>
              </div>
            </div>

        </div>
        <!-- /page content -->
      </div>
    </div>
{% endblock %}


{% block script %}
    <script type="text/javascript">
const imgIndicador = 'egresos-lesiones-formula.png';
const indicador = 'te_lesiones';

        var mapObject;
         var myStyle = [
  {
    "featureType": "administrative",
    "elementType": "geometry",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "administrative.land_parcel",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "administrative.neighborhood",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "administrative.province",
    "stylers": [
      {
        "color": "#000000"
      },
      {
        "visibility": "off"
      },
      {
        "weight": 8
      }
    ]
  },
  {
    "featureType": "landscape",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "labels.text",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "labels",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "labels.icon",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "transit",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "water",
    "stylers": [
      {
        "color": "#c7f6ff"
      },
      {
        "weight": 8
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  }
];

    </script>

    <!-- jQuery -->
    <script src="{% static 'vendors/jquery/dist/jquery.min.js' %}"></script>
    <!-- Bootstrap -->
    <script src="{% static 'vendors/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'vendors/bootstrap/dist/js/bootstrap-slider.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
    <!-- FastClick -->
    <script src="{% static 'vendors/fastclick/lib/fastclick.js' %}"></script>
    <!-- NProgress -->
    <script src="{% static 'vendors/nprogress/nprogress.js' %}"></script>
    <!-- Chart.js -->
    <script src="{% static 'vendors/Chart.js/dist/Chart.min.js' %}"></script>
    <!-- gauge.js -->
    <script src="{% static 'vendors/gauge.js/dist/gauge.min.js' %}"></script>
    <!-- bootstrap-progressbar -->
    <script src="{% static 'vendors/bootstrap-progressbar/bootstrap-progressbar.min.js' %}"></script>
    <!-- iCheck -->
    <script src="{% static 'vendors/iCheck/icheck.min.js' %}"></script>
    <!-- Skycons -->
    <script src="{% static 'vendors/skycons/skycons.js' %}"></script>
    <!-- Flot -->
    <script src="{% static 'vendors/Flot/jquery.flot.js' %}"></script>
    <script src="{% static 'vendors/Flot/jquery.flot.pie.js' %}"></script>
    <script src="{% static 'vendors/Flot/jquery.flot.time.js' %}"></script>
    <script src="{% static 'vendors/Flot/jquery.flot.stack.js' %}"></script>
    <script src="{% static 'vendors/Flot/jquery.flot.resize.js' %}"></script>
    <!-- Flot plugins -->
    <script src="{% static 'vendors/flot.orderbars/js/jquery.flot.orderBars.js' %}"></script>
    <script src="{% static 'vendors/flot-spline/js/jquery.flot.spline.min.js' %}"></script>
    <script src="{% static 'vendors/flot.curvedlines/curvedLines.js' %}"></script>
    <!-- DateJS -->
    <script src="{% static 'vendors/DateJS/build/date.js' %}"></script>
    <!-- JQVMap -->
    <script src="{% static 'vendors/jqvmap/dist/jquery.vmap.js' %}"></script>
    <script src="{% static 'vendors/jqvmap/dist/maps/jquery.vmap.world.js' %}"></script>
    <script src="{% static 'vendors/jqvmap/examples/js/jquery.vmap.sampledata.js' %}"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="{% static 'vendors/moment/min/moment.min.js' %}"></script>
    <script src="{% static 'vendors/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
  <!-- jQuery autocomplete -->
  <script src="{% static 'vendors/devbridge-autocomplete/dist/jquery.autocomplete.min.js' %}"></script>
    <!-- ECharts -->
    <script src="{% static 'vendors/echarts/dist/echarts.min.js' %}"></script>
    <script src="{% static 'vendors/echarts/map/js/world.js' %}"></script>
  <!-- jQuery multiselect -->
  <script type="text/javascript" src="{% static 'vendors/pangeos/build/js/jquery-multiple-select/bootstrap-multiselect.js' %}"></script>
    <!-- Custom Theme Scripts -->
    <script src="{% static 'vendors/pangeos/build/js/custom.js' %}"></script>
    <!-- INTROJS -->
    <script src="{% static 'vendors/introjs/js/intro.min.js' %}"></script>
  <!--MAPS  -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
  
    <script type="text/javascript" src="{% static 'vendors/html2canvas/html2canvas.js' %}"></script> 

    <script src="{% static 'vendors/sweetalert/dist/sweetalert2.min.js' %}"></script>

    <script type="text/javascript" src="{% static 'vendors/pangeos/pangeos.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/pangeos/indicadores/js/script/te_lesiones.js' %}"></script> 
    <script type="text/javascript" src="{% static 'vendors/pangeos/indicadores/js/ayuda/pangeos-ayuda.js' %}"></script> 
    <script type="text/javascript" src="{% static 'vendors/pangeos/pangeos-descargartabla.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/pangeos/pangeos-pdf.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/geoxml3/js/geoxml3.js' %}"></script>
    <script type="text/javascript">

        jQuery(document).ready(function(){
            $("#crearimagen").click(function() { 
                downloadCanvas('content_gb', 'suicidio_edades.png');
            });
            $("#crearimagen_pastel").click(function() { 
                downloadCanvas('content_gp', 'suicidio_medio.png');
            });
            $("#crearimagen_distribucion").click(function() { 
                downloadCanvas('content_distribucion', 'distribucion_entidad.png');
            });
            $("#ficha_indicador").click(function() { 
                pdf_ficha();
            });
        });

        function downloadCanvas(canvasId, filename) {
            // Obteniendo la etiqueta la cual se desea convertir en imagen
            var domElement = document.getElementById(canvasId);

            // Utilizando la función html2canvas para hacer la conversión
            html2canvas(domElement, {
                useCORS: true,
                //backgroundColor: "#ffffff"
                }).then(canvas => {
                    dataURL = canvas.toDataURL("image/jpeg", 1.0);
                    var a = document.createElement('a');
                    a.href=dataURL.replace("image/jpeg", "image/octet-stream");
                    a.download = filename;
                    a.click();
            });
        }


      var cdmxkml="5";

      array_kml = [
        'aguascalientes',
        'bajacalifornia',
        'bajacaliforniasur',
        'campeche',
        'chiapas',
        'chihuahua',
        'cdmx',
        'coahuila',
        'colima',
        'durango',
        'guanajuato',
        'guerrero',
        'hidalgo',
        'jalisco',
        'mexico',
        'michoacan',
        'morelos',
        'nayarit',
        'nuevoleon',
        'oaxaca',
        'puebla',
        'queretaro',
        'quintanaroo',
        'sanluispotosi',
        'sinaloa',
        'sonora',
        'tabasco',
        'tamaulipas',
        'tlaxcala',
        'veracruz',
        'yucatan',
        'zacatecas'
      ];

      var layer = [];


        var addListenersOnPolygon = function(polygon) {
            google.maps.event.addListener(polygon, 'click', function (event) {
                // alert(polygon.indexID);
            });  
        }


        function initMap() {
          mapObject = new google.maps.Map(document.getElementById('googleMaps'), {
           mapTypeControlOptions: {
             mapTypeIds: ['mystyle', google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.TERRAIN]
           },
            center: new google.maps.LatLng(24.0701514,-100.9255709),
            streetViewControl: false,
            mapTypeControl: false,
            disableDefaultUI: true,
            zoomControl: true,
            zoom: 5,
            mapTypeId: 'mystyle'
          });


          mapObject.mapTypes.set('mystyle', new google.maps.StyledMapType(myStyle, { name: 'My Style' }));
          var bounds = new google.maps.LatLngBounds();

        }

      jQuery("#filtroBuscar").click(function(){
          if( arrayKML.length == 0 ) {
              Swal.fire({
                title: '¡Error!',
                text: 'Es necesario indicar al menos un municipio. Inténtalo nuevamente.',
                icon: 'error',
                confirmButtonText: 'Aceptar'
              });
              return false;
          }
          if( arrayFiles.length > 0 ) {
              for (i = 0; i < layer.length; i++) {
                if( layer[i] !== null ) {
                  layer[i].setMap(null);
                  layer[i]=null;
                }
              }
              jQuery.ajax({
                    url: 'crearKML.php',
                    method: 'post',
                    data: {data: JSON.stringify(arrayFiles) },
                    success: function(t) {
                        _obj = jQuery.parseJSON(t);
                        var r = "https://demoinp.gaipp.mx/production/tmp/";
                        jQuery("#filtroLimpiar").css({"display":"block"});
                        jQuery("#filtroGrafica").css({"display":"block"});
                        jQuery("#geochart-colors").css({"display":"none"});
                        jQuery("#googleMaps").css({"display":"block"});
                        for (var i = 0; i < _obj.length; i++) {
                            src = r+_obj[i];
                            if(!isExistsKML(src)){
                                showKML(src);
                            }
                        }                    
                        jQuery("#btnMostrarImagen").css({"display":"block"});
                        jQuery("#btnMostrarMapa").css({"display":"block"});
                        setTimeout(centerMap, 1000);

                        // arrayFiles=[];
                    }
              });
          }
      });

      jQuery("#btnMostrarImagen").click(function(){
          dataMap();
      });

      jQuery("#btnMostrarMapa").click(function(){
          cambiaMapa('a');
      });

      jQuery("#fullScreen").click(function(){
          cambiaMapa('r');
      });

      function centerMap(){
          for (i = 0; i < layer.length; i++) {
              if( layer[i] !== null ) {
                  if (typeof bounds === "undefined") {
                      bounds = layer[i].getDefaultViewport();
                  } else {
                      bounds.union(layer[i].getDefaultViewport());
                  }
              }
              mapObject.fitBounds(bounds);
          }
          bounds = new google.maps.LatLngBounds();;
      }

      function isExistsKML(_kml) {
          for (i = 0; i < layer.length; i++) {
              if(layer[i] !== null && layer[i].url == _kml ) {
                  return true;
              }
          }
          return false
      }

      function showKML(kml) {
          // var myParser = new geoXML3.parser({map: mapObject});
          var kmlLayer = new google.maps.KmlLayer({
            url: kml,
            map: mapObject
          });

google.maps.event.addListener(kmlLayer, 'click', function(kmlEvent) {
    var text = kmlEvent.featureData.description;
});

          // myParser.parse(kml);
          layer.push(kmlLayer);
      }

      function limpiarFormulario(){
          jQuery("#estadosselector").html('<option value="0">-- Seleccionar estado</option>');
          jQuery("#regionselector").val(0);
          for (i = 0; i < layer.length; i++) {
            if( layer[i] !== null ) {
              layer[i].setMap(null);
              layer[i]=null;
            }
          }
          municipiosSEL=[];
          arrayKML=[];
          arrayFiles=[];
          layer=[];
          jQuery(".btag").remove();
          jQuery("#estadosselector").children("option").css({"display":"block"});
          jQuery("#geochart-colors").css({"display":"block"});
          jQuery("#googleMaps").css({"display":"none"});
          jQuery('#dropmunicipios').html('');
          jQuery('#dropmunicipios').multiselect('destroy');
          jQuery("#btnMostrarImagen").css({"display":"none"});
          jQuery("#btnMostrarMapa").css({"display":"none"});
      }

      jQuery("#filtroLimpiar").click(function(){
          limpiarFormulario();
      });


        function dataMap() {
            var c = mapObject.getCenter();
            var z = mapObject.getZoom();
            jQuery(".modal-googleMaps").css( { "width": parseFloat(((jQuery("#googleMaps").css("width")).replace("%","")).replace("px",""))+32+"px", "height": parseFloat(((jQuery("#googleMaps").css("height")).replace("%","")).replace("px",""))+32+"px", "display":"none" } );
                html2canvas( document.querySelector("#googleMaps"),
                {
                  useCORS: true
                }).then(canvas => {
                  dataURL = canvas.toDataURL("image/jpeg", 1.0);
                  var a = document.createElement('a');
                  a.href=dataURL.replace("image/jpeg", "image/octet-stream");
                  a.download = 'pangeos.jpg';
                  a.click();
                jQuery("#modalImageMap").html('');
                jQuery("#modalImageMap").append(canvas);
                jQuery("#modalImageMap").css({"display":"none"});
            });
        }

      function switchMaps(){
          var gmd=jQuery("#googleMaps").css("display");
          if(gmd=="none") {
            jQuery("#geochart-colors").css({"display":"none"});
            jQuery("#googleMaps").css({"display":"block"});
          } else {
            jQuery("#geochart-colors").css({"display":"block"});
            jQuery("#googleMaps").css({"display":"none"});
          }
      }
      
      function cambiaMapa(s) {
          switch(s) {
              case 'a':
                  jQuery("#controles").css({"right":"-353px"});
                  jQuery("#fullScreen").css({"display":"block"});
                  jQuery("#googleMaps").css({"position":"fixed", "display":"block", "width":"100vw", "height":"100vh", "z-index":"99", "left":"0px", "top":"0px"});
              break;
              case 'r':
                  jQuery("#controles").css({"right":"-325px"});
                  jQuery("#fullScreen").css({"display":"none"});
                  jQuery("#googleMaps").css({"position":"relative", "display":"block", "width":"100%", "height":"462px", "z-index":"10"});
              break;
          }
          centerMap();
      }

    </script>
    <script defer async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA09vQhZhG6svDBJaik7Xs3vO0vmSvqCYE&callback=initMap"></script>

{% endblock %}
